{namespace s=Subugoe\Find\ViewHelpers}
{namespace g=Gjz18\TmplGjz\ViewHelpers}

<f:if condition="{s:data.isArray(subject:'{s:data.valueForKey(array:document.fields, key:field)}')}">
	<f:if condition="{f:count(subject:'{s:data.valueForKey(array:document.fields, key:field)}')} != 1">
		<f:then>
			<f:for each="{s:data.valueForKey(array:document.fields, key:field)}" as="value" iteration="iterator">
				<f:alias map="{
					labelValidation:'{g:horLinkBezugLabelValidation(array:document.fields.d039D, key:iterator.index)}',
					valid:'valid',
					validUnspecified:'validUnspecified'
				}">
					<f:if condition="{labelValidation} == {valid}">
						<f:then>
							<form>
								<label>
									{g:horLinkBezugLabel(array:document.fields.d039D, key:iterator.index)} :
								</label>
								<output>
									<f:link.action
										action="detail"
										controller="Search"
										arguments="{
											id:'{g:horLinkBezugPpn(array:document.fields.d039D, key:iterator.index)}'
										}"
										class="internal"
										noCacheHash="1"
									>
										<g:strreplace search="@" replace="">
											{g:horLinkBezugContent(array:document.fields.d039D, key:iterator.index)}
										</g:strreplace>
									</f:link.action>
								</output>
							</form>
						</f:then>
						<f:else>
							<f:if condition="{labelValidation} == {validUnspecified}">
								<form>
									<label>
										verknüpfter Datensatz :
									</label>
									<output>
										<f:link.action
											action="detail"
											controller="Search"
											arguments="{
												id:'{g:horLinkBezugPpn(array:document.fields.d039D, key:iterator.index)}'
											}"
											class="internal"
											noCacheHash="1"
										>
											<g:strreplace search="@" replace="">
												{g:horLinkBezugContent(array:document.fields.d039D, key:iterator.index)}
											</g:strreplace>
										</f:link.action>
									</output>
								</form>
							</f:if>
						</f:else>
					</f:if>
				</f:alias>
			</f:for>
		</f:then>
		<f:else>
			<f:alias map="{
				labelValidation:'{g:horLinkBezugLabelValidation(array:document.fields.d039D, key:0)}',
				valid:'valid'
			}">
				<f:if condition="{labelValidation} == {valid}">
					<f:then>
						<form>
							<label>
								{g:horLinkBezugLabel(array:document.fields.d039D, key:0)} :
							</label>
							<output>
								<f:link.action
									action="detail"
									controller="Search"
									arguments="{
										id:'{g:horLinkBezugPpn(array:document.fields.d039D, key:0)}'
									}"
									class="internal"
									noCacheHash="1"
								>
									<g:strreplace search="@" replace="">
										{g:horLinkBezugContent(array:document.fields.d039D, key:0)}
									</g:strreplace>
								</f:link.action>
							</output>
						</form>
					</f:then>
					<f:else>
						<f:if condition="{labelValidation} == {validUnspecified}">
							<form>
								<label>
									verknüpfter Datensatz :
								</label>
								<output>
									<f:link.action
										action="detail"
										controller="Search"
										arguments="{
											id:'{g:horLinkBezugPpn(array:document.fields.d039D, key:0)}'
										}"
										class="internal"
										noCacheHash="1"
									>
										<g:strreplace search="@" replace="">
											{g:horLinkBezugContent(array:document.fields.d039D, key:0)}
										</g:strreplace>
									</f:link.action>
								</output>
							</form>
						</f:if>
					</f:else>
				</f:if>
			</f:alias>
		</f:else>
	</f:if>
</f:if>